<AddAnimalScreen@MDScreen>:
    md_bg_color: self.theme_cls.backgroundColor  # âœ… Fix

    MDScreen:
        MDBoxLayout:
            orientation: "vertical"
            spacing: "8dp"
            padding: "16dp"

            MDTopAppBar:
                type: "small"

                MDTopAppBarLeadingButtonContainer:
                    MDActionTopAppBarButton:
                        icon: "arrow-left"
                        on_release: setattr(app.root, 'current', 'home')

                MDTopAppBarTitle:
                    text: "Add Animal"
                    pos_hint: {"center_x": .5}

            MDScrollView:
                MDBoxLayout:
                    orientation: "vertical"
                    spacing: "12dp"
                    padding: "8dp"
                    adaptive_height: True
                    size_hint_y: None

                    MDTextField:
                        id: animal_name
                        mode: "outlined"
                        MDTextFieldHintText:
                            text: "Animal ID"

                    MDBoxLayout:
                        spacing: "12dp"
                        adaptive_height: True

                        MDTextField:
                            id: species_dropdown
                            mode: "outlined"
                            on_focus: root.show_species_menu() if self.focus else None
                            MDTextFieldHintText:
                                text: "Species"

                        MDTextField:
                            id: animal_breed
                            mode: "outlined"
                            MDTextFieldHintText:
                                text: "Breed"

                    MDBoxLayout:
                        spacing: "12dp"
                        adaptive_height: True

                        MDTextField:
                            id: animal_birth_date
                            mode: "outlined"
                            on_focus: root.show_date_picker(self)
                            MDTextFieldHintText:
                                text: "Date of birth"

                        MDTextField:
                            id: sex_dropdown
                            mode: "outlined"
                            on_focus: root.show_sex_menu() if self.focus else None
                            MDTextFieldHintText:
                                text: "Sex"

                        MDBoxLayout:
                            orientation: "horizontal"
                            spacing: "8dp"
                            adaptive_height: True
                            MDCheckbox:
                                id: animal_castrated
                                size_hint: None, None
                                size: "36dp", "36dp"
                            MDLabel:
                                text: "Castrated"
                                valign: "middle"

                    MDBoxLayout:
                        spacing: "12dp"
                        adaptive_height: True

                        MDTextField:
                            id: animal_weight
                            mode: "outlined"
                            input_filter: "float"
                            MDTextFieldHintText:
                                text: "Weight"

                        MDTextField:
                            id: weight_unit
                            mode: "outlined"
                            on_focus: root.show_weight_unit_menu() if self.focus else None
                            MDTextFieldHintText:
                                text: "Unit"

                    MDBoxLayout:
                        spacing: "12dp"
                        adaptive_height: True

                        MDButton:
                            style: "elevated"
                            size_hint_y: None
                            height: "48dp"
                            font_size: "16sp"
                            text_color: [1,1,1,1]
                            on_release: root.show_file_chooser()
                            MDButtonText:
                                text: "Choose Photo"
                            MDButtonIcon:
                                icon: "file"

                        FitImage:
                            id: photo_preview
                            size_hint: None, None
                            size: "100dp", "100dp"
                            allow_stretch: True
                            keep_ratio: True

            MDBoxLayout:
                spacing: "12dp"
                padding: "8dp"
                size_hint_y: None
                height: "64dp"

                MDButton:
                    style: "elevated"
                    on_release: root.save_animal()
                    MDButtonText:
                        text: "Save animal"
                    MDButtonIcon:
                        icon: "save"

                MDButton:
                    style: "text"
                    on_release: app.go_back()
                    MDButtonText:
                        text: "Cancel"
                    MDButtonIcon:
                        icon: "cancel"